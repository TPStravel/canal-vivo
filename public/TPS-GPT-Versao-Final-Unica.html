
<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<title>TPS ‚Äì Travel Personally Secretary</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #1a1a3d;
      color: white;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    .sidebar {
      width: 230px;
      background-color: #2c2c5d;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .sidebar h2 { font-size: 20px; margin-bottom: 20px; }
    .item {
      margin-bottom: 16px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .item:hover { transform: scale(1.03); }
    .item img {
      width: 100%; height: 120px; object-fit: cover;
      border-radius: 8px; margin-bottom: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    }
    .item span { font-size: 14px; text-align: center; display: block; }

    .main {
      flex: 1;
      background-color: #000;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 40px 20px 100px;
      overflow-y: auto;
    }

    .logo {
      font-size: 36px;
      font-weight: bold;
      color: #3fa3ff;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .mensagem-social {
      font-size: 14px;
      text-align: center;
      max-width: 600px;
      color: #ffd700;
      margin: 8px 0 12px 0;
    }
    .slogan {
      font-size: 18px;
      text-align: center;
      max-width: 600px;
      color: #ccc;
      line-height: 1.5;
      margin-bottom: 20px;
    }

    #mensagensCentrais {
      width: 100%;
      max-width: 600px;
      text-align: left;
      padding-left: 20px;
      font-size: 14px;
      margin-top: 10px;
    }

    .input-area {
      position: absolute;
      bottom: 20px;
      left: 250px;
      right: 320px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    textarea {
      flex: 1;
      padding: 10px;
      min-height: 50px;
      max-height: 70px;
      resize: none;
      border-radius: 5px;
      border: none;
      font-size: 14px;
      background-color: #222;
      color: white;
    }

    button {
      background-color: #4f46e5;
      border: none;
      padding: 10px 16px;
      color: white;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
    }

    .discord {
      width: 300px;
      background-color: #14142b;
      padding: 20px;
      display: flex;
      flex-direction: column;
      border-left: 1px solid #222;
    }

    .chat-log {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      background-color: #1e1e3f;
      padding: 10px;
      border-radius: 5px;
    }

    .chat-log div {
      text-align: left;
      margin-bottom: 6px;
      font-size: 14px;
    }

    .chat-input {
      display: flex;
      gap: 6px;
    }

    .chat-input input {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 4px;
      background-color: #2b2b4f;
      color: white;
    }

    .chat-input button {
      padding: 8px 12px;
      background-color: #4f46e5;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }

    .abas {
      display: flex;
      gap: 10px;
      position: absolute;
      top: 20px;
      right: 40px;
    }

    .abas .aba {
      background-color: #4f46e5;
      border: none;
      color: white;
      padding: 10px 18px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .abas .aba:hover {
      background-color: #6d63ff;
      transform: translateY(-1px);
    }

    .abas .aba.ativa {
      background-color: #3b36c8;
    }
  
#mensagensCentrais div {
  margin-bottom: 18px;
  line-height: 1.6;
}
</style>
</head>
<body>
<div class="sidebar">
<div>
<h2>üîç Explorar</h2>
<div class="item"><img src="https://images.unsplash.com/photo-1500916434205-0c77489c6cf7?w=400&amp;h=300&amp;fit=crop"/><span>Paris</span></div>
<div class="item"><img src="https://images.unsplash.com/photo-1496442226666-8d4d0e62e6e9?w=400&amp;h=300&amp;fit=crop"/><span>New York</span></div>
<div class="item"><img src="https://images.unsplash.com/photo-1549693578-d683be217e58?w=400&amp;h=300&amp;fit=crop"/><span>Seoul</span></div>
<div class="item"><img src="https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=400&amp;h=300&amp;fit=crop"/><span>T√≥quio</span></div>
<div class="item"><img src="https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=400&amp;h=300&amp;fit=crop"/><span>Londres</span></div>
</div>
<div style="font-size: 11px; color: #ccc;">Vers√£o TPS</div>
</div>
<div class="main">
<div class="abas">
<button class="aba ativa">‚úàÔ∏è Voos</button>
<button class="aba">üè® Hot√©is</button>
<button class="aba">üöó Carros</button>
<button class="aba">üõ°Ô∏è Seguro</button>
</div>
<div class="logo">TPS</div>
<div class="mensagem-social">üå± Cada viagem atrav√©s do TPS contribui para a√ß√µes sociais reais.<br/>Obrigado por fazer a diferen√ßa.</div>
<div class="slogan">‚úàÔ∏è Bem-vindo ao seu assistente de viagem pessoal.<br/>Me diga de onde voc√™ sai, para onde vai e quando pretende viajar.</div>
<div id="mensagensCentrais" style="position:absolute;left:210px; top:240px;top:260px;max-width:400px;font-size:14px;text-align:left;color:#ccc;"></div>
<div class="input-area">
<textarea id="userInput" placeholder="Digite sua mensagem..."></textarea>
<button onclick="enviarMensagemCentral()">Enviar</button>
</div>
</div>
<div class="discord">
<div class="chat-log" id="chatLog">
<div><strong>ü§ñ:</strong> Bem-vindo ao chat lateral.</div>
</div>
<div class="chat-input">
<input id="chatInput" placeholder="Digite aqui..." type="text"/>
<button onclick="enviarMensagemLateral()">Enviar</button>
</div>
</div>
<script>
function enviarMensagemCentral() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  const log = document.getElementById("mensagensCentrais");
  const div = document.createElement("div");
  div.innerHTML = "<strong>üë§:</strong> " + text;
  log.appendChild(div);
  input.value = "";
  log.scrollTop = log.scrollHeight;
}

function enviarMensagemLateral() {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;
  const log = document.getElementById("chatLog");
  const div = document.createElement("div");
  div.innerHTML = "<strong>üë§:</strong> " + text;
  log.appendChild(div);
  input.value = "";
  log.scrollTop = log.scrollHeight;
}

document.getElementById("userInput").addEventListener("keydown", function(e) {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    enviarMensagemCentral();
  }
});
</script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDReBGhb2gZNv7KA86HJXTeiLimWTrurp8",
    authDomain: "canal-vivo-chat.firebaseapp.com",
    projectId: "canal-vivo-chat"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
<script>
const translations = {
  pt: { placeholder: "Digite sua mensagem...", send: "Enviar" },
  en: { placeholder: "Type your message...", send: "Send" },
  es: { placeholder: "Escribe tu mensaje...", send: "Enviar" },
  ko: { placeholder: "Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...", send: "Î≥¥ÎÇ¥Í∏∞" },
  fr: { placeholder: "Tapez votre message...", send: "Envoyer" },
  de: { placeholder: "Geben Sie Ihre Nachricht ein...", send: "Senden" },
  it: { placeholder: "Scrivi il tuo messaggio...", send: "Invia" },
  ja: { placeholder: "„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...", send: "ÈÄÅ‰ø°" },
  zh: { placeholder: "ËæìÂÖ•‰Ω†ÁöÑÊ∂àÊÅØ...", send: "ÂèëÈÄÅ" },
  ru: { placeholder: "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...", send: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" },
  hi: { placeholder: "‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≤‡§ø‡§ñ‡•á‡§Ç...", send: "‡§≠‡•á‡§ú‡•á‡§Ç" },
  ar: { placeholder: "ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ...", send: "ÿ•ÿ±ÿ≥ÿßŸÑ" }
};

window.onload = () => {
  const lang = new URLSearchParams(window.location.search).get('lang') || 'pt';
  const t = translations[lang] || translations.pt;
  document.getElementById("userInput")?.setAttribute("placeholder", t.placeholder);
  document.querySelector("button")?.textContent = t.send;
  localStorage.setItem("aceitouCookies", "true");
};

function enviarMensagemCentral() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  const log = document.getElementById("mensagensCentrais");
  const div = document.createElement("div");
  div.innerHTML = "<strong>üë§:</strong> " + text;
  log.appendChild(div);
  input.value = "";
  log.scrollTop = log.scrollHeight;

  const lang = new URLSearchParams(window.location.search).get('lang') || 'pt';
  db.collection("mensagens_tps").add({
    mensagem: text,
    remetente: "user",
    idioma: lang,
    timestamp: new Date()
  });
}
</script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDReBGhb2gZNv7KA86HJXTeiLimWTrurp8",
    authDomain: "canal-vivo-chat.firebaseapp.com",
    projectId: "canal-vivo-chat"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  function getUserID() {
    let id = localStorage.getItem("usuarioID_TPS");
    if (!id) {
      id = "uid_" + Math.random().toString(36).substring(2, 10);
      localStorage.setItem("usuarioID_TPS", id);
    }
    return id;
  }

  async function verificarLimite() {
    const userId = getUserID();
    const docRef = db.collection("contagem_uso_tps").doc(userId);
    const doc = await docRef.get();
    const dados = doc.exists ? doc.data() : { mensagens: 0 };
    if (dados.mensagens >= 40) {
      alert("‚ö†Ô∏è Voc√™ atingiu o limite gratuito de 40 mensagens. Ative o Plano Pro para continuar.");
      return false;
    }
    await docRef.set({ mensagens: dados.mensagens + 1, atualizado_em: new Date() }, { merge: true });
    return true;
  }

  async function enviarMensagemCentral() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;

    const log = document.getElementById("mensagensCentrais");
    const divUser = document.createElement("div");
    divUser.innerHTML = "<strong>üë§:</strong> " + text;
    log.appendChild(divUser);
    input.value = "";
    log.scrollTop = log.scrollHeight;

    const lang = new URLSearchParams(window.location.search).get('lang') || 'pt';

    try {
      const response = await fetch("/api/gpt", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text, lang })
      });
      const data = await response.json();
      const reply = data.result || "(sem resposta)";

      const divGpt = document.createElement("div");
      divGpt.innerHTML = "<strong>ü§ñ:</strong> " + reply;
      log.appendChild(divGpt);
      log.scrollTop = log.scrollHeight;

      const historico = JSON.parse(localStorage.getItem("chatHistory")) || [];
      historico.push({ message: text, response: reply });
      localStorage.setItem("chatHistory", JSON.stringify(historico));

      db.collection("mensagens_tps").add({
        mensagem: text,
        resposta: reply,
        idioma: lang,
        timestamp: new Date()
      });
    } catch (err) {
      const erroDiv = document.createElement("div");
      erroDiv.innerHTML = "<strong>‚ö†Ô∏è:</strong> Erro ao conectar com o servidor.";
      log.appendChild(erroDiv);
    }
  }

  document.getElementById("userInput").addEventListener("keydown", function(e) {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      verificarLimite().then(pode => {
        if (pode) enviarMensagemCentral();
      });
    }
  });
</script>

<script>
let etapaVoo = 0;
let origemVoo = "", destinoVoo = "", dataVoo = "";
let modoAtual = "";

function iniciarFluxoVoos() {
  modoAtual = "voos";
  etapaVoo = 1;
  adicionarMensagemBot("‚úàÔ∏è Para te ajudar com sua passagem a√©rea, posso saber a cidade de origem, destino e data da viagem?");
}

function adicionarMensagemBot(msg) {
  const log = document.getElementById("mensagensCentrais");
  const div = document.createElement("div");
  div.innerHTML = "<strong>ü§ñ:</strong> " + msg;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

function adicionarMensagemUsuario(msg) {
  const log = document.getElementById("mensagensCentrais");
  const div = document.createElement("div");
  div.innerHTML = "<strong>üë§:</strong> " + msg;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

document.querySelectorAll(".aba")[0].onclick = () => {
  iniciarFluxoVoos();
};

async function enviarMensagemCentral() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;
  adicionarMensagemUsuario(text);
  input.value = "";

  const lang = new URLSearchParams(window.location.search).get('lang') || 'pt';

  if (modoAtual === "voos") {
    if (etapaVoo === 1) {
      if (text.toLowerCase().includes("guarulhos") && text.toLowerCase().includes("new york") && text.includes("10")) {
        origemVoo = "Guarulhos (GRU)";
        destinoVoo = "Nova York (NYC)";
        dataVoo = "10 de maio";
        etapaVoo = 2;
        adicionarMensagemBot(`üü¶ J√° entendi que a origem √© <b>${origemVoo}</b>, destino √© <b>${destinoVoo}</b> e a data aproximada √© <b>${dataVoo}</b>. S√≥ preciso confirmar:
        <ul><li>A data exata √© mesmo <b>${dataVoo}</b>?</li><li>Voc√™ prefere <b>ida e volta</b> ou s√≥ ida?</li><li>Alguma prefer√™ncia de hor√°rio, classe ou companhia a√©rea?</li></ul>`);
      } else {
        adicionarMensagemBot("Pode me informar origem, destino e data da viagem? Ex: 'Guarulhos para New York dia 10 de maio'.");
      }
    } else if (etapaVoo === 2) {
      etapaVoo = 3;
      adicionarMensagemBot(`‚úàÔ∏è Procurando voos de <b>${origemVoo}</b> para <b>${destinoVoo}</b> em <b>${dataVoo}</b>... Aguarde um momento!`);
      setTimeout(() => {
        adicionarMensagemBot(`
        <b>‚úàÔ∏è Op√ß√µes de Voos ‚Äì ${dataVoo} de 2025</b>
        <table border="1" cellspacing="0" cellpadding="4" style="margin-top:8px;font-size:13px;">
          <tr><th>‚Ññ</th><th>Companhia</th><th>Sa√≠da</th><th>Chegada</th><th>Classe</th><th>Terminal</th><th>Pre√ßo</th></tr>
          <tr><td>1</td><td>LATAM</td><td>22:50</td><td>06:30 (+1)</td><td>üíº Econ√¥mica</td><td>GRU T3 ‚Üí JFK T4</td><td>R$ 4.500</td></tr>
          <tr><td>2</td><td>American</td><td>21:30</td><td>05:10 (+1)</td><td>üíº Econ√¥mica</td><td>GRU T3 ‚Üí JFK T8</td><td>R$ 4.700</td></tr>
          <tr><td>3</td><td>Delta</td><td>22:00</td><td>06:00 (+1)</td><td>üíº Econ√¥mica</td><td>GRU T3 ‚Üí JFK T4</td><td>R$ 4.600</td></tr>
          <tr><td>4</td><td>United</td><td>23:55</td><td>07:45 (+1)</td><td>üíº Econ√¥mica</td><td>GRU T3 ‚Üí EWR</td><td>R$ 4.550</td></tr>
          <tr><td>5</td><td>Copa</td><td>02:00</td><td>14:30</td><td>üíº Econ√¥mica</td><td>GRU T2 ‚Üí JFK T4</td><td>R$ 3.200</td></tr>
        </table>
        <div style='font-size:13px;color:#ccc;margin-top:6px;'>üí° Os voos diretos duram cerca de 9h30min. A op√ß√£o da Copa tem escala no Panam√° (~12h30min).</div><br>
        Deseja ver <b>hot√©is</b> ou <b>aluguel de carros</b> tamb√©m?
        `);
      }, 1200);
    }
    return;
  }

  // fallback: usar GPT normalmente
  try {
    const response = await fetch("/api/gpt", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text, lang })
    });
    const data = await response.json();
    const resposta = data.result || "(sem resposta)";
    adicionarMensagemBot(resposta);
    saveToLocalStorage(text, resposta);
    saveToFirebase(text, resposta);
  } catch (error) {
    adicionarMensagemBot("Erro ao conectar com o servidor.");
  }
}
</script>
</body>
</html>
